{% extends "base.html" %}
{% load static %}

{% block title %}TACAE - Inicio{% endblock %}

{% block content %}
<!-- Encabezado principal -->
<header class="home-header">
  <img src="{% static 'img/tacae.jpg' %}" alt="TACAE Logo" class="home-logo">
  <h1>Bienvenido a TACAE</h1>
  <p>Sistema de Gestión Empresarial</p>
  
  <!-- Sección de acciones en el encabezado: campana + botón de cerrar sesión -->
  <div class="header-actions">
    <!-- Ícono de campana que abre el dropdown de notificaciones -->
      <div class="bell-icon" onclick="toggleDropdown()">
        <img src="{% static 'img/campana.png' %}" alt="Campana">
      {% if total_no_leidas %}
        <span class="badge">{{ total_no_leidas }}</span>
      {% endif %}
    </div>
    
    <!-- Botón de Cerrar Sesión (ajusta la URL según tu proyecto) -->
    <a href="{% url 'login' %}" class="logout-btn">Cerrar Sesión</a>
  </div>
</header>

<!-- Dropdown de Notificaciones -->
<div class="dropdown-content" id="notificationsDropdown">
  {% if notificaciones_no_leidas %}
    {% for noti in notificaciones_no_leidas %}
      <div class="dropdown-item">
        <strong>{{ noti.mensaje }}</strong><br>
        <small>{{ noti.fecha_creacion|date:"d/m/Y H:i" }}</small>
      </div>
    {% endfor %}
  {% else %}
    <div class="dropdown-item">No tienes notificaciones</div>
  {% endif %}
  <div class="dropdown-footer">
    <!-- Ajusta la URL a la vista unificada de notificaciones -->
    <a href="{% url 'notificaciones:unificadas' %}">Ver todo</a>
  </div>
</div>

<!-- Contenido principal de la página -->
<section class="home-content">
  <!-- Ejemplo: Solo visible si el usuario es staff -->
  {% if user.is_authenticated and user.is_staff %}
    <div class="card">
      <h2>Gestión de Empleados</h2>
      <p>Administra la información de tus empleados de forma eficiente.</p>
      <a href="{% url 'lista_empleados' %}" class="card-btn">Ver Empleados</a>
    </div>
  {% endif %}

  <!-- Ejemplo: Card de Carpetas/Documentos -->
  <div class="card">
    <h2>INFORME PERICIALES GRUPO TACAE</h2>
    <p>Gestiona carpetas y documentos de forma organizada.</p>
    <a href="{% url 'carpetas:listar_carpetas' %}" class="card-btn">Ingresar</a>
  </div>

  <!-- Ejemplo: Card para Eventos -->
  <div class="card">
    <h2>Eventos</h2>
    <p>Mantente informado sobre nuestros próximos eventos y actividades.</p>
    <a href="{% url 'eventos:listar_eventos' %}" class="btn btn-primary">Ver Eventos</a>
  </div>
</section>

<!-- Estilos CSS -->
<style>
  /* Estilos globales */
  body {
    background: #f5f7fa;
    font-family: 'Helvetica', Arial, sans-serif;
    color: #333;
    margin: 0;
    padding: 0;
  }
  /* Encabezado */
  .home-header {
    text-align: center;
    margin-bottom: 20px;
    position: relative;
    padding: 20px 0;
  }
  .home-logo {
    width: 120px;
    border-radius: 8px;
  }
  .home-header h1 {
    font-size: 2rem;
    color: #003366;
    margin: 10px 0 5px;
  }
  .home-header p {
    font-size: 1.1rem;
    color: #555;
    margin: 0;
  }
  /* Acciones del encabezado (campana + cerrar sesión) */
  .header-actions {
    position: absolute;
    top: 20px;
    right: 20px;
    display: flex;
    align-items: center;
    gap: 20px;
  }
  .logout-btn {
    background: #a22c2c;
    color: #fff;
    padding: 8px 16px;
    border-radius: 4px;
    text-decoration: none;
    font-weight: bold;
    transition: background 0.3s ease;
  }
  .logout-btn:hover {
    background: #c62828;
  }
  /* Dropdown de notificaciones */
  .dropdown-content {
    display: none;
    position: absolute;
    top: 60px;
    right: 20px;
    width: 250px;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 5px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    z-index: 1000;
  }
  .dropdown-item {
    padding: 10px;
    border-bottom: 1px solid #eee;
    font-size: 14px;
    color: #333;
  }
  .dropdown-item:last-child {
    border-bottom: none;
  }
  .dropdown-footer {
    padding: 10px;
    text-align: center;
    background: #f9f9f9;
  }
  .dropdown-footer a {
    color: #0277bd;
    text-decoration: none;
  }
  .dropdown-footer a:hover {
    text-decoration: underline;
  }
  /* Contenido principal */
  .home-content {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
    padding: 20px;
  }
  .card {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    width: 300px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    text-align: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .card:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 15px rgba(0,0,0,0.2);
  }
  .card h2 {
    font-size: 1.5rem;
    color: #003366;
    margin-bottom: 10px;
  }
  .card p {
    font-size: 1rem;
    color: #666;
    margin-bottom: 15px;
  }
  .card-btn {
    display: inline-block;
    padding: 10px 15px;
    background: #003366;
    color: #fff;
    border-radius: 4px;
    text-decoration: none;
    transition: background 0.3s ease;
  }
  .card-btn:hover {
    background: #002244;
  }
  /* Campana de notificaciones */
  .bell-icon {
    position: relative;
    display: inline-block;
    cursor: pointer;
    font-size: 24px;
    color: #003366;
  }
  .bell-icon img {
    width: 30px;
    transition: transform 0.5s ease;
  }
  .bell-icon:hover img {
    animation: swing 0.5s ease;
  }
  @keyframes swing {
    0% { transform: rotate(0deg); }
    20% { transform: rotate(15deg); }
    40% { transform: rotate(-10deg); }
    60% { transform: rotate(5deg); }
    80% { transform: rotate(-5deg); }
    100% { transform: rotate(0deg); }
  }
  .bell-icon .badge {
    position: absolute;
    top: -8px;
    right: -8px;
    background: #d32f2f;
    color: #fff;
    font-size: 12px;
    border-radius: 50%;
    padding: 2px 6px;
  }
  /* Animación de entrada para el dropdown */
  @keyframes fadeInDropdown {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .dropdown-content.show {
    display: block;
    animation: fadeInDropdown 0.3s ease;
  }
</style>

<!-- Script para mostrar/ocultar dropdown -->
<script>
  function toggleDropdown() {
    var dropdown = document.getElementById("notificationsDropdown");
    dropdown.classList.toggle("show");
  }
  window.onclick = function(event) {
    var dropdown = document.getElementById("notificationsDropdown");
    if (!event.target.closest('.bell-icon') && !event.target.closest('.dropdown-content')) {
      dropdown.classList.remove("show");
    }
  }
</script>

{% endblock %}
